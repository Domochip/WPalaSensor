<h2 class="content-subhead">Sensor Simulator<span id="l"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>
<form class="pure-form pure-form-aligned" id='f'>
    <fieldset>

<h3 class="content-subhead">Calibration</h3>
<div class="pure-control-group">
    <label>Calibrator</label>
    <a class="pure-button" id="calibButton" style="background: rgb(28, 184, 65);">Run</a>
</div>
<div class="pure-control-group">
    <label for="sha">Coeff A</label>
    <input type='number' id='sha' name='sha' step="0.0000000000000001" size=30>
</div>
<div class="pure-control-group">
    <label for="shb">Coeff B</label>
    <input type='number' id='shb' name='shb' step="0.0000000000000001" size=30>
</div>
<div class="pure-control-group">
    <label for="shc">Coeff C</label>
    <input type='number' id='shc' name='shc' step="0.0000000000000001" size=30>
</div>

<h3 class="content-subhead">Home Automation</h3>

<div class="pure-control-group">
    <label for="hae">Type</label>
    <select id='hae' name='hae'>
        <option value="0">None</option>
        <option value="1">Jeedom</option>
        <option value="2">Fibaro</option>
    </select>
</div>

<div id='ha' style='display:none'>
    <div class="pure-control-group">
        <label for="hatls">SSL/TLS</label>
        <input type='checkbox' id='hatls' name='hatls'>
    </div>
    <div class="pure-control-group">
        <label for="hah">Hostname</label>
        <input type='text' id='hah' name='hah' maxlength='64' pattern='[A-Za-z0-9-.]+' size='50' title='DNS name or IP of the Jeedom server'>
        <span class="pure-form-message-inline">(Hostname should match with certificate name if SSL/TLS is enabled)</span>
    </div>

    <div id='j' style='display:none'>

        <div class="pure-control-group">
            <label for="ja">ApiKey</label>
            <input type='password' id='ja' name='ja' maxlength='48' pattern='[A-Za-z0-9-.]+' size=50 title='APIKey from Jeedom configuration webpage'>
        </div>
    </div>

    <div id='fib' style='display:none'>
    
        <div class="pure-control-group">
            <label for="fu">Username</label>
            <input type='text' id='fu' name='fu' maxlength='64'>
        </div>
        <div class="pure-control-group">
            <label for="fp">Password</label>
            <input type='password' id='fp' name='fp' maxlength='64'>
        </div>
    </div>
    <div class="pure-control-group">
        <label for="hatid">Temperature Id</label>
        <input type='number' id='hatid' name='hatid' min='0' max='65535'>
        <span class="pure-form-message-inline">(Command Or Device Id)</span>
    </div>
    <div id='hatlse'>
        <div class="pure-control-group">
            <label for="hafp">TLS FingerPrint</label>
            <input type='text' id='hafp' name='hafp' maxlength='59' pattern='^([0-9A-Fa-f]{2}[ :-]*){19}([0-9A-Fa-f]{2})$' size='65'>
            <span class="pure-form-message-inline">(separators are : &lt;none&gt;,&lt;space&gt;,:,-)</span>
        </div>
    </div>
</div>

<h3 class="content-subhead">Palazzetti</h3>

<div class="pure-control-group">
    <label for="cbe" class="pure-checkbox">Palazzetti ConnectionBox</label>
    <input type='checkbox' id='cbe' name='cbe'>
</div>
<div id='cb' style='display:none'>
    <div class="pure-control-group">
        <label for="cbi">ConnectionBox IP</label>
        <input type='text' id='cbi' name='cbi' pattern='((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}$'>
    </div>
</div>

        <div class="pure-controls">
            <input type='submit' value='Save' class="pure-button pure-button-primary" disabled>
        </div>
    </fieldset>
</form>
<span id='r'></span>

<script>
    //QuerySelector Prefix is added by load function to know into what element queySelector need to look for
    //var qsp = '#contentX ';

    $(qsp+"#calibButton").addEventListener('click',function (evt){
        evt.preventDefault();
        emptyContents();
        $("#mainHeader").textContent="Calibration";
        load($("#content1"),"/calib.html");
    });

    $(qsp+"#hae").addEventListener('change',function (){
        switch($(qsp+"#hae").value){
            case "0":
                $(qsp+"#ha").style.display='none';
                break;
            case "1":
                $(qsp+"#fib").style.display='none';
                $(qsp+"#j").style.display='';
                $(qsp+"#ha").style.display='';
                break;
            case "2":
                $(qsp+"#j").style.display='none';
                $(qsp+"#fib").style.display='';
                $(qsp+"#ha").style.display='';
                break;
        }
    });

    $(qsp+"#hatls").addEventListener('change',function (){
        if($(qsp+"#hatls").checked) $(qsp+"#hatlse").style.display='';
        else $(qsp+"#hatlse").style.display='none';
    });

    $(qsp+"#cbe").addEventListener('change',function (){
        if($(qsp+"#cbe").checked) $(qsp+"#cb").style.display='';
        else $(qsp+"#cb").style.display='none';
    });

    $(qsp+"#f").addEventListener('submit',function(event){
        $(qsp+"#r").innerHTML="Saving Configuration...";
        post("/sc"+qsp[8],
            new FormData($(qsp+"#f")),
            function(){ 
                $(qsp+"#f").style.display='none';

                $(qsp+'#r').innerHTML='<h3><b>Configuration saved <span style="color: green;">successfully</span>.</b></h3>This page will be reloaded in <span id="cd">5</span>sec.';
                runScript('var count=4;var cdi=setInterval(function(){$("#cd").innerText=count;if(!count){clearInterval(cdi);location.reload();}count--;},1000);');
            },
            function(){
                $(qsp+'#r').innerHTML='<h3><b>Configuration <span style="color: red;">error</span>.</b></h3>';
            }
        );
        event.preventDefault();
    });

    getJSON("/gc"+qsp[8],
        function(GC){
            for(k in GC){
                if($(qsp+'#'+k)){
                    if($(qsp+'#'+k).type!='checkbox') $(qsp+'#'+k).value=GC[k];
                    else $(qsp+'#'+k).checked=GC[k];

                    triggerEvent($(qsp+'#'+k),'change');
                }
            }

            $(qsp+"#f input[type=submit]").disabled=false;
            fadeOut($(qsp+"#l"));
        },
        function(){
            $(qsp+"#l").innerHTML='<h6 style="display:inline;color:red;"><b> Failed</b></h6>';
        }
    );
</script>